{% extends 'base.html' %}
{% load static %}

{% block title %}Booking history{% endblock title %}

{% block head %}
  <h1 class="text-2xl font-semibold text-gray-900">Booking History</h1>
{% endblock head %}

{% block content %}
  <table class="table w-full mb-6">
    <thead>
      <tr class="border-b border-gray-300">
        <th class="text-left text-sm font-medium text-gray-500 p-4">ID</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Job</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Owner</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Caregiver</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Pet</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Start Date</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">End Date</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Status</th>
        <th class="text-left text-sm font-medium text-gray-500 p-4">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% if bookings %}
        {% for booking in bookings %}
          <tr class="border-b border-gray-200 hover:bg-gray-50">
            <td class="p-4 text-sm text-gray-700">{{ booking.id }}</td>
            <td class="p-4 text-sm text-gray-700">
              <a href="{% url 'job_post_detail' booking.proposal.job_post.id %}" class="text-blue-600 hover:underline">
                {{ booking.proposal.job_post.title }}
              </a>
            </td>
            <td class="p-4 text-sm text-gray-700">{{ booking.owner.username }}</td>
            <td class="p-4 text-sm text-gray-700">{{ booking.caregiver.username }}</td>
            <td class="p-4 text-sm text-gray-700">{{ booking.pet.name }} ({{ booking.pet.species }})</td>
            <td class="p-4 text-sm text-gray-700">{{ booking.start|date:"d M Y H:i" }}</td>
            <td class="p-4 text-sm text-gray-700">{{ booking.end|date:"d M Y H:i" }}</td>
            <td class="p-4 text-sm">
              {% if booking.status == 'P' %}
                <span class="inline-block px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-semibold">Pending</span>
              {% elif booking.status == 'C' %}
                <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold">Confirmed</span>
              {% elif booking.status == 'D' %}
                <span class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold">Completed</span>
              {% elif booking.status == 'X' %}
                <span class="inline-block px-3 py-1 bg-red-100 text-red-800 rounded-full text-xs font-semibold">Cancelled</span>
              {% else %}
                <span class="inline-block px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-semibold">{{ booking.get_status_display }}</span>
              {% endif %}
            </td>
            <td class="p-4 text-sm text-gray-700">
              {% if not booking.review %}
                <form id="reviewForm-{{ booking.id }}" method="post" action="{% url 'write_review' booking.id %}">
                  {% csrf_token %}
                  <button type="submit" class="text-blue-600 hover:underline">Write a Review</button>
                </form>
              {% else %}
                <span class="text-green-600 text-sm">Reviewed</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr class="text-gray-500 text-[14px] text-center">
          <td colspan="9" class="p-4">No booking history yet.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
{% endblock content %}
