{% extends 'base.html' %}
{% load static %}

{% block title %}PetTech{% endblock title %}

{% block head %}
  <div class="max-w-4xl mx-auto mt-8 text-center">
    <h1 class="text-4xl font-extrabold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á üêæ</h1>
    <p class="text-gray-500 mt-2">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>
  </div>
{% endblock head %}

{% block content %}
  <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg mt-10 mb-20">

    <!-- ‡πÅ‡∏™‡∏î‡∏á Messages -->
    {% if messages %}
      <div class="mb-6 space-y-2">
        {% for message in messages %}
          <div class="p-4 rounded-lg text-center font-medium
            {% if message.tags == 'error' %}
              bg-red-100 text-red-700
            {% elif message.tags == 'success' %}
              bg-green-100 text-green-700
            {% elif message.tags == 'warning' %}
              bg-yellow-100 text-yellow-700
            {% else %}
              bg-blue-100 text-blue-700
            {% endif %}
          ">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô -->
    <div class="border-b pb-6 mb-6">
      <h2 class="text-3xl font-semibold text-blue-700 mb-2">{{ job_post.title }}</h2>
      <p class="text-gray-600 mb-1"><strong>‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:</strong> {{ job_post.pet.name }} ({{ job_post.pet.species }})</p>
      <p class="text-gray-600 mb-1"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ job_post.start|date:"d M Y H:i" }} - {{ job_post.end|date:"d M Y H:i" }}</p>
      <p class="text-gray-600 mb-1"><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ job_post.location }}</p>
      <p class="text-gray-600 mb-4"><strong>‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:</strong> {% if job_post.budget %}‡∏ø{{ job_post.budget }}{% else %}‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏{% endif %}</p>
      <p class="text-gray-700 leading-relaxed">{{ job_post.description }}</p>

      {% if user == job_post.owner %}
        <div class="flex gap-3 mt-6">
          <a href="{% url 'job_post_edit' job_post.id %}" class="bg-yellow-500 text-white px-5 py-2 rounded-lg font-medium hover:bg-yellow-600 transition">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô</a>
          <form method="post" action="{% url 'job_post_delete' job_post.id %}" onsubmit="return confirm('‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏à‡∏∞‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
            {% csrf_token %}
            <button type="submit" class="bg-red-500 text-white px-5 py-2 rounded-lg font-medium hover:bg-red-600 transition">üóëÔ∏è ‡∏•‡∏ö‡∏á‡∏≤‡∏ô</button>
          </form>
        </div>
      {% endif %}
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á -->
    {% if user == job_post.owner %}
      <h3 class="text-2xl font-semibold mb-4 text-blue-600">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h3>
      {% if proposals %}
        <ul class="space-y-4">
          {% for proposal in proposals %}
            <li class="border border-gray-200 p-5 rounded-xl shadow-sm hover:shadow-md transition bg-gray-50 {% if proposal.status == 'accepted' %}border-green-400{% elif proposal.status == 'rejected' %}opacity-75{% endif %}">
              <p class="text-gray-800"><strong>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:</strong> {{ proposal.caregiver.username }}</p>
              <p class="text-gray-700"><strong>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</strong> {{ proposal.message }}</p>
              <p class="text-gray-700"><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠:</strong> ‡∏ø{{ proposal.proposed_rate }}</p>
              <p class="text-gray-500 text-sm mt-1"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á:</strong> {{ proposal.created_at|date:"d M Y H:i" }}</p>
              <p class="mt-2">
                <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong>
                {% if proposal.status == 'accepted' %}
                  <span class="text-green-600 font-semibold">‚úÖ ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
                {% elif proposal.status == 'rejected' %}
                  <span class="text-red-600 font-semibold">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß</span>
                {% else %}
                  <span class="text-yellow-600 font-semibold">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</span>
                {% endif %}
              </p>
              
              {% if job_post.status == 'open' and proposal.status == 'pending' %}
                <form method="post" action="{% url 'proposal_accept' job_post.id proposal.id %}" class="mt-3">
                  {% csrf_token %}
                  <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">‚úÖ ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠</button>
                </form>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</p>
      {% endif %}
    {% endif %}

    <!-- ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠ -->
    {% if user != job_post.owner and user.is_authenticated %}
      <div class="mt-10 border-t pt-6">
        <h3 class="text-2xl font-semibold mb-4 text-blue-600">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚úâÔ∏è</h3>
        
        {% if proposal_form %}
          <form action="{% url 'proposal_submit' job_post.id %}" method="post" class="space-y-5">
            {% csrf_token %}

            {% if proposal_form.non_field_errors %}
              <div class="bg-red-100 text-red-700 p-3 rounded-lg">{{ proposal_form.non_field_errors }}</div>
            {% endif %}
            
            <div>
              <label class="block text-gray-700 font-semibold mb-2">{{ proposal_form.message.label }}</label>
              {% if proposal_form.message.errors %}
                <p class="text-red-600 text-sm mt-1">{{ proposal_form.message.errors.0 }}</p>
              {% endif %}
            </div>
            
            <div>
              <label class="block text-gray-700 font-semibold mb-2">{{ proposal_form.proposed_rate.label }}</label>
              {% if proposal_form.proposed_rate.errors %}
                <p class="text-red-600 text-sm mt-1">{{ proposal_form.proposed_rate.errors.0 }}</p>
              {% endif %}
            </div>
            
            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠</button>
          </form>
        {% else %}
          <p class="text-gray-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ (‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß)</p>
        {% endif %}
      </div>
    {% endif %}
  </div>
{% endblock content %}
